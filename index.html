<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI + Practical Tools Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #f7f4ec;
      --bg-2: #e2efdc;
      --spot-1: #ffd9b8;
      --spot-2: #cce8bc;
      --ink: #1c2a20;
      --primary: #1e7a52;
      --primary-hover: #146741;
      --primary-2: #f08534;
      --card: rgba(255, 255, 255, 0.8);
      --hero-bg: rgba(255, 255, 255, 0.72);
      --input-bg: #ffffff;
      --out-bg: rgba(255, 255, 255, 0.95);
      --line: rgba(28, 42, 32, 0.12);
      --shadow: 0 14px 32px rgba(20, 38, 28, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "IBM Plex Sans KR", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 12% 12%, var(--spot-1) 0, transparent 28%),
        radial-gradient(circle at 87% 80%, var(--spot-2) 0, transparent 32%),
        linear-gradient(135deg, var(--bg-1), var(--bg-2));
      transition: background 240ms ease, color 240ms ease;
    }

    body.dark-mode {
      --bg-1: #101417;
      --bg-2: #1a232c;
      --spot-1: #253246;
      --spot-2: #203a31;
      --ink: #eaf2f8;
      --primary: #3f9bff;
      --primary-hover: #2e85e5;
      --primary-2: #ef9d57;
      --card: rgba(22, 30, 40, 0.84);
      --hero-bg: rgba(20, 28, 38, 0.82);
      --input-bg: #111922;
      --out-bg: rgba(15, 22, 31, 0.95);
      --line: rgba(234, 242, 248, 0.16);
      --shadow: 0 18px 34px rgba(0, 0, 0, 0.45);
    }

    .wrap {
      width: min(1120px, 92%);
      margin: 40px auto 60px;
    }

    .hero {
      background: var(--hero-bg);
      border: 1px solid var(--line);
      border-radius: 22px;
      padding: 26px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
      animation: rise 650ms ease;
    }

    .hero-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 14px;
      flex-wrap: wrap;
    }

    .hero-copy { flex: 1 1 520px; }

    .hero h1 {
      margin: 0 0 10px;
      font-family: "Space Grotesk", sans-serif;
      font-size: clamp(1.8rem, 4vw, 2.8rem);
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      line-height: 1.55;
      max-width: 70ch;
      opacity: 0.92;
    }

    .hero-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .theme-toggle, .lang-toggle {
      min-width: 120px;
      align-self: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px;
      margin-top: 18px;
    }

    .tool {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow);
      animation: rise 700ms ease;
    }

    .tool h2 {
      margin: 0 0 8px;
      font-family: "Space Grotesk", sans-serif;
      font-size: 1.2rem;
    }

    .tool p {
      margin: 0 0 12px;
      font-size: 0.94rem;
      opacity: 0.85;
    }

    .tool.full { grid-column: 1 / -1; }

    textarea, input, select {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: var(--input-bg);
      color: var(--ink);
      font: inherit;
      margin-bottom: 10px;
    }

    textarea { min-height: 120px; resize: vertical; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .char-row {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 10px;
      align-items: center;
    }

    button {
      border: 0;
      border-radius: 12px;
      padding: 10px 14px;
      font: inherit;
      font-weight: 700;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      transition: transform 140ms ease, background 180ms ease;
    }

    button:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .ghost { background: var(--primary-2); }

    .canvas-wrap {
      border: 1px dashed var(--line);
      border-radius: 14px;
      background: var(--out-bg);
      padding: 10px;
      margin-top: 6px;
      display: flex;
      justify-content: center;
    }

    #charCanvas {
      width: min(100%, 360px);
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      background: #f0f3f6;
      display: block;
    }

    .out {
      margin-top: 10px;
      background: var(--out-bg);
      border: 1px dashed var(--line);
      border-radius: 12px;
      padding: 12px;
      min-height: 60px;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(14px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 860px) {
      .grid { grid-template-columns: 1fr; }
      .tool.full { grid-column: auto; }
      .row { grid-template-columns: 1fr; }
      .char-row { grid-template-columns: 1fr; }
      .theme-toggle, .lang-toggle { width: 100%; }
      .hero-actions { width: 100%; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="hero">
      <div class="hero-top">
        <div class="hero-copy">
          <h1 id="heroTitle"></h1>
          <p id="heroDesc"></p>
        </div>
        <div class="hero-actions">
          <button id="langToggle" class="lang-toggle" type="button" onclick="toggleLanguage()"></button>
          <button id="themeToggle" class="theme-toggle" type="button" onclick="toggleTheme()"></button>
        </div>
      </div>
    </section>

    <section class="grid">
      <article class="tool full">
        <h2 id="charTitle"></h2>
        <p id="charDesc"></p>
        <div class="char-row">
          <input id="charInput" type="file" accept="image/*" />
          <button id="charBtn" type="button" onclick="generateCharacter()"></button>
          <button id="charRerollBtn" type="button" onclick="rerollCharacter()"></button>
          <button id="charDownloadBtn" type="button" class="ghost" onclick="downloadCharacter()"></button>
        </div>
        <div class="canvas-wrap">
          <canvas id="charCanvas" width="360" height="360"></canvas>
        </div>
        <div id="charOut" class="out"></div>
      </article>

      <article class="tool full">
        <h2 id="sumTitle"></h2>
        <p id="sumDesc"></p>
        <textarea id="sumInput"></textarea>
        <button id="sumBtn" onclick="summarizeText()"></button>
        <div id="sumOut" class="out"></div>
      </article>

      <article class="tool">
        <h2 id="convTitle"></h2>
        <p id="convDesc"></p>
        <div class="row">
          <input id="convValue" type="number" />
          <select id="convType">
            <option value="km-mile" id="convKmMile"></option>
            <option value="mile-km" id="convMileKm"></option>
            <option value="c-f" id="convCF"></option>
            <option value="f-c" id="convFC"></option>
          </select>
        </div>
        <button id="convBtn" onclick="convertUnit()"></button>
        <div id="convOut" class="out"></div>
      </article>

      <article class="tool">
        <h2 id="pwTitle"></h2>
        <p id="pwDesc"></p>
        <div class="row">
          <input id="pwLen" type="number" min="8" max="64" value="14" />
          <select id="pwMode">
            <option value="all" id="pwAll"></option>
            <option value="alnum" id="pwAlnum"></option>
            <option value="letters" id="pwLetters"></option>
          </select>
        </div>
        <button id="pwBtn" class="ghost" onclick="generatePassword()"></button>
        <div id="pwOut" class="out"></div>
      </article>
    </section>
  </main>

  <script>
    let currentLang = 'ko';
    let uploadedImage = null;
    let characterReady = false;
    let lastType = '';

    const CHARACTER_TYPES = ['cat', 'fox', 'bear', 'panda', 'robot'];

    const I18N = {
      ko: {
        htmlLang: 'ko',
        title: 'AI + 실용 툴 스튜디오',
        heroTitle: 'AI + 실용 툴 스튜디오',
        heroDesc: '사진을 보고 닮은 동물/물체 스타일로 얼굴을 합성하는 기능을 포함합니다.',
        langToggle: 'English',
        themeLight: '화이트모드',
        themeDark: '블랙모드',
        charTitle: '1) 닮은꼴 합성 생성기',
        charDesc: '사진을 분석해 "이 사람은 이거 닮았네" 타입을 추천하고, 해당 캐릭터에 얼굴을 합성합니다.',
        charBtn: '닮은꼴 만들기',
        charRerollBtn: '다른 추천',
        charDownloadBtn: '이미지 저장',
        sumTitle: '2) AI 텍스트 요약기',
        sumDesc: '긴 글에서 핵심 문장만 간단히 추출합니다.',
        sumBtn: '요약하기',
        sumPlaceholder: '요약할 텍스트를 입력하세요.',
        convTitle: '3) 단위 변환기',
        convDesc: '길이(km↔mile), 온도(C↔F)를 변환합니다.',
        convBtn: '변환하기',
        convValuePlaceholder: '값 입력',
        convKmMile: 'km → mile',
        convMileKm: 'mile → km',
        convCF: '°C → °F',
        convFC: '°F → °C',
        pwTitle: '4) 안전 비밀번호 생성기',
        pwDesc: '길이/문자 옵션을 선택해 강한 비밀번호를 만듭니다.',
        pwBtn: '생성하기',
        pwAll: '영문+숫자+특수문자',
        pwAlnum: '영문+숫자',
        pwLetters: '영문만',
        typeNames: { cat: '고양이', fox: '여우', bear: '곰', panda: '판다', robot: '로봇' },
        defaults: {
          charOut: '사진을 올린 뒤 닮은꼴 만들기를 눌러주세요.',
          sumOut: '결과가 여기에 표시됩니다.',
          convOut: '변환 결과가 여기에 표시됩니다.',
          pwOut: '생성된 비밀번호가 여기에 표시됩니다.'
        },
        msg: {
          enterText: '텍스트를 먼저 입력하세요.',
          enterNumber: '숫자 값을 입력하세요.',
          photoFirst: '먼저 사진을 업로드하세요.',
          photoLoaded: '사진이 로드되었습니다. 닮은꼴 만들기를 눌러주세요.',
          photoError: '이미지를 읽지 못했습니다. 다른 파일로 시도하세요.',
          charDone: (name) => `추천 결과: ${name} 닮은꼴로 얼굴 합성이 완료되었습니다.`,
          rerolled: (name) => `다른 추천 적용: ${name} 닮은꼴로 다시 만들었습니다.`
        },
        summaryKeywords: ['중요', '핵심', '결론', '문제', '해결', '효율', '성과', '전략']
      },
      en: {
        htmlLang: 'en',
        title: 'AI + Practical Tools Studio',
        heroTitle: 'AI + Practical Tools Studio',
        heroDesc: 'Includes a look-alike compositor that places your face on a recommended animal/object style.',
        langToggle: '한국어',
        themeLight: 'Light Mode',
        themeDark: 'Dark Mode',
        charTitle: '1) Look-Alike Composer',
        charDesc: 'Analyzes your photo, picks a look-alike type, then composites your face into that character.',
        charBtn: 'Create Look-Alike',
        charRerollBtn: 'Another Pick',
        charDownloadBtn: 'Save Image',
        sumTitle: '2) AI Text Summarizer',
        sumDesc: 'Extract key sentences from long text quickly.',
        sumBtn: 'Summarize',
        sumPlaceholder: 'Enter text to summarize.',
        convTitle: '3) Unit Converter',
        convDesc: 'Convert length (km↔mile) and temperature (C↔F).',
        convBtn: 'Convert',
        convValuePlaceholder: 'Enter value',
        convKmMile: 'km → mile',
        convMileKm: 'mile → km',
        convCF: '°C → °F',
        convFC: '°F → °C',
        pwTitle: '4) Secure Password Generator',
        pwDesc: 'Generate a strong password with selectable options.',
        pwBtn: 'Generate',
        pwAll: 'Letters + Numbers + Symbols',
        pwAlnum: 'Letters + Numbers',
        pwLetters: 'Letters only',
        typeNames: { cat: 'Cat', fox: 'Fox', bear: 'Bear', panda: 'Panda', robot: 'Robot' },
        defaults: {
          charOut: 'Upload a photo, then click create look-alike.',
          sumOut: 'Results will appear here.',
          convOut: 'Converted result will appear here.',
          pwOut: 'Generated password will appear here.'
        },
        msg: {
          enterText: 'Please enter text first.',
          enterNumber: 'Please enter a numeric value.',
          photoFirst: 'Please upload a photo first.',
          photoLoaded: 'Photo loaded. Click create look-alike.',
          photoError: 'Could not read this image. Try another file.',
          charDone: (name) => `Recommendation: ${name}. Face compositing is complete.`,
          rerolled: (name) => `Another recommendation applied: ${name}.`
        },
        summaryKeywords: ['important', 'key', 'conclusion', 'problem', 'solution', 'efficient', 'result', 'strategy']
      }
    };

    function setOutput(id, text, isDefault) {
      const out = document.getElementById(id);
      out.textContent = text;
      out.dataset.default = isDefault ? 'true' : 'false';
    }

    function updateThemeButtonText() {
      const t = I18N[currentLang];
      const isDark = document.body.classList.contains('dark-mode');
      document.getElementById('themeToggle').textContent = isDark ? t.themeLight : t.themeDark;
    }

    function applyTheme(theme) {
      const isDark = theme === 'dark';
      document.body.classList.toggle('dark-mode', isDark);
      localStorage.setItem('themeMode', isDark ? 'dark' : 'light');
      updateThemeButtonText();
    }

    function toggleTheme() {
      const nextTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
      applyTheme(nextTheme);
    }

    function applyLanguage(lang) {
      currentLang = lang === 'en' ? 'en' : 'ko';
      const t = I18N[currentLang];

      document.documentElement.lang = t.htmlLang;
      document.title = t.title;
      document.getElementById('heroTitle').textContent = t.heroTitle;
      document.getElementById('heroDesc').textContent = t.heroDesc;
      document.getElementById('langToggle').textContent = t.langToggle;

      document.getElementById('charTitle').textContent = t.charTitle;
      document.getElementById('charDesc').textContent = t.charDesc;
      document.getElementById('charBtn').textContent = t.charBtn;
      document.getElementById('charRerollBtn').textContent = t.charRerollBtn;
      document.getElementById('charDownloadBtn').textContent = t.charDownloadBtn;

      document.getElementById('sumTitle').textContent = t.sumTitle;
      document.getElementById('sumDesc').textContent = t.sumDesc;
      document.getElementById('sumBtn').textContent = t.sumBtn;
      document.getElementById('sumInput').placeholder = t.sumPlaceholder;

      document.getElementById('convTitle').textContent = t.convTitle;
      document.getElementById('convDesc').textContent = t.convDesc;
      document.getElementById('convBtn').textContent = t.convBtn;
      document.getElementById('convValue').placeholder = t.convValuePlaceholder;
      document.getElementById('convKmMile').textContent = t.convKmMile;
      document.getElementById('convMileKm').textContent = t.convMileKm;
      document.getElementById('convCF').textContent = t.convCF;
      document.getElementById('convFC').textContent = t.convFC;

      document.getElementById('pwTitle').textContent = t.pwTitle;
      document.getElementById('pwDesc').textContent = t.pwDesc;
      document.getElementById('pwBtn').textContent = t.pwBtn;
      document.getElementById('pwAll').textContent = t.pwAll;
      document.getElementById('pwAlnum').textContent = t.pwAlnum;
      document.getElementById('pwLetters').textContent = t.pwLetters;

      ['charOut', 'sumOut', 'convOut', 'pwOut'].forEach((id) => {
        const el = document.getElementById(id);
        if (!el.dataset.default || el.dataset.default === 'true') {
          setOutput(id, t.defaults[id], true);
        }
      });

      localStorage.setItem('langMode', currentLang);
      updateThemeButtonText();
    }

    function toggleLanguage() {
      applyLanguage(currentLang === 'ko' ? 'en' : 'ko');
    }

    function drawImageCover(ctx, img, size) {
      const scale = Math.max(size / img.width, size / img.height);
      const w = img.width * scale;
      const h = img.height * scale;
      const x = (size - w) / 2;
      const y = (size - h) / 2;
      ctx.drawImage(img, x, y, w, h);
    }

    function renderCanvasPlaceholder() {
      const c = document.getElementById('charCanvas');
      const ctx = c.getContext('2d');
      const t = I18N[currentLang];
      ctx.clearRect(0, 0, c.width, c.height);
      const g = ctx.createLinearGradient(0, 0, c.width, c.height);
      g.addColorStop(0, '#dce7f5');
      g.addColorStop(1, '#f5ddcf');
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, c.width, c.height);
      ctx.fillStyle = 'rgba(0,0,0,0.18)';
      ctx.font = '600 18px Space Grotesk, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(t.charBtn, c.width / 2, c.height / 2);
    }

    function analyzeTraits(img) {
      const off = document.createElement('canvas');
      off.width = 64;
      off.height = 64;
      const ctx = off.getContext('2d');
      drawImageCover(ctx, img, 64);
      const d = ctx.getImageData(0, 0, 64, 64).data;

      let r = 0, g = 0, b = 0;
      for (let i = 0; i < d.length; i += 4) {
        r += d[i];
        g += d[i + 1];
        b += d[i + 2];
      }
      const n = d.length / 4;
      r /= n;
      g /= n;
      b /= n;
      const brightness = (r + g + b) / 3;
      const sat = Math.max(r, g, b) - Math.min(r, g, b);
      return { r, g, b, brightness, sat };
    }

    function pickCharacterType(traits, excludeType = '') {
      const scores = {
        cat: traits.brightness * 0.35 + traits.sat * 0.55 + traits.g * 0.1,
        fox: traits.r * 0.65 + traits.sat * 0.25 - traits.b * 0.2,
        bear: (255 - traits.brightness) * 0.8 + traits.r * 0.2,
        panda: traits.brightness * 0.6 + (255 - traits.sat) * 0.4,
        robot: traits.b * 0.6 + traits.g * 0.3 + traits.sat * 0.1
      };

      const ordered = Object.entries(scores)
        .sort((a, b) => b[1] - a[1])
        .map((v) => v[0]);

      if (!excludeType) return ordered[0];
      const next = ordered.find((type) => type !== excludeType);
      return next || ordered[0];
    }

    function drawTemplate(ctx, type, size) {
      ctx.clearRect(0, 0, size, size);

      const bg = ctx.createLinearGradient(0, 0, size, size);
      if (type === 'fox') {
        bg.addColorStop(0, '#ffe1b8');
        bg.addColorStop(1, '#ffb86e');
      } else if (type === 'bear') {
        bg.addColorStop(0, '#d2b48c');
        bg.addColorStop(1, '#8f6a4a');
      } else if (type === 'panda') {
        bg.addColorStop(0, '#f7f7f7');
        bg.addColorStop(1, '#d8dde2');
      } else if (type === 'robot') {
        bg.addColorStop(0, '#b9d9ff');
        bg.addColorStop(1, '#88a9d2');
      } else {
        bg.addColorStop(0, '#ffd6dc');
        bg.addColorStop(1, '#ffc2a9');
      }
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, size, size);

      ctx.fillStyle = 'rgba(255,255,255,0.42)';
      ctx.beginPath();
      ctx.arc(size * 0.18, size * 0.2, size * 0.2, 0, Math.PI * 2);
      ctx.arc(size * 0.84, size * 0.12, size * 0.16, 0, Math.PI * 2);
      ctx.fill();

      const bodyY = size * 0.68;
      if (type === 'robot') {
        ctx.fillStyle = '#5a6f8c';
        ctx.fillRect(size * 0.28, bodyY - 20, size * 0.44, size * 0.28);
        ctx.fillStyle = '#9ec1ea';
        ctx.fillRect(size * 0.33, bodyY - 4, size * 0.34, size * 0.1);
      } else {
        const bodyColor = type === 'bear' ? '#6f4b35' : type === 'fox' ? '#d06f2f' : type === 'panda' ? '#212121' : '#cb8a8a';
        ctx.fillStyle = bodyColor;
        ctx.beginPath();
        ctx.ellipse(size * 0.5, bodyY + 24, size * 0.21, size * 0.18, 0, 0, Math.PI * 2);
        ctx.fill();
      }

      if (type === 'cat') {
        ctx.fillStyle = '#c9847c';
        ctx.beginPath();
        ctx.moveTo(size * 0.29, size * 0.22);
        ctx.lineTo(size * 0.37, size * 0.06);
        ctx.lineTo(size * 0.43, size * 0.23);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(size * 0.57, size * 0.23);
        ctx.lineTo(size * 0.63, size * 0.06);
        ctx.lineTo(size * 0.71, size * 0.22);
        ctx.fill();
      }

      if (type === 'fox') {
        ctx.fillStyle = '#cd6829';
        ctx.beginPath();
        ctx.moveTo(size * 0.28, size * 0.24);
        ctx.lineTo(size * 0.34, size * 0.06);
        ctx.lineTo(size * 0.44, size * 0.24);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(size * 0.56, size * 0.24);
        ctx.lineTo(size * 0.66, size * 0.06);
        ctx.lineTo(size * 0.72, size * 0.24);
        ctx.fill();
      }

      if (type === 'bear' || type === 'panda') {
        const earColor = type === 'panda' ? '#1b1b1b' : '#5f3f2f';
        ctx.fillStyle = earColor;
        ctx.beginPath();
        ctx.arc(size * 0.33, size * 0.16, size * 0.08, 0, Math.PI * 2);
        ctx.arc(size * 0.67, size * 0.16, size * 0.08, 0, Math.PI * 2);
        ctx.fill();
      }

      if (type === 'robot') {
        ctx.fillStyle = '#4f6078';
        ctx.fillRect(size * 0.24, size * 0.18, size * 0.52, size * 0.08);
      }
    }

    function drawFaceCutout(ctx, img, size) {
      const faceX = size * 0.5;
      const faceY = size * 0.44;
      const faceR = size * 0.18;

      ctx.save();
      ctx.beginPath();
      ctx.arc(faceX, faceY, faceR, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      const srcW = img.width * 0.52;
      const srcH = img.height * 0.52;
      const srcX = (img.width - srcW) / 2;
      const srcY = img.height * 0.12;
      ctx.drawImage(img, srcX, srcY, srcW, srcH, faceX - faceR, faceY - faceR, faceR * 2, faceR * 2);
      ctx.restore();

      ctx.strokeStyle = 'rgba(255,255,255,0.85)';
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.arc(faceX, faceY, faceR, 0, Math.PI * 2);
      ctx.stroke();
    }

    function renderCharacter(type, statusBuilder) {
      const t = I18N[currentLang];
      const c = document.getElementById('charCanvas');
      const ctx = c.getContext('2d');
      const size = c.width;

      drawTemplate(ctx, type, size);
      drawFaceCutout(ctx, uploadedImage, size);

      ctx.fillStyle = 'rgba(0,0,0,0.55)';
      ctx.fillRect(10, size - 44, size - 20, 30);
      ctx.fillStyle = '#ffffff';
      ctx.font = '600 15px IBM Plex Sans KR, sans-serif';
      ctx.textAlign = 'center';
      const label = t.typeNames[type];
      ctx.fillText(label, size / 2, size - 23);

      characterReady = true;
      lastType = type;
      setOutput('charOut', statusBuilder(label), false);
    }

    function onPhotoSelected(event) {
      const t = I18N[currentLang];
      const file = event.target.files[0];
      if (!file) {
        uploadedImage = null;
        characterReady = false;
        setOutput('charOut', t.defaults.charOut, true);
        renderCanvasPlaceholder();
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          uploadedImage = img;
          characterReady = false;
          setOutput('charOut', t.msg.photoLoaded, false);
          const c = document.getElementById('charCanvas');
          const ctx = c.getContext('2d');
          ctx.clearRect(0, 0, c.width, c.height);
          drawImageCover(ctx, img, c.width);
        };
        img.onerror = () => {
          uploadedImage = null;
          characterReady = false;
          setOutput('charOut', t.msg.photoError, false);
          renderCanvasPlaceholder();
        };
        img.src = reader.result;
      };
      reader.onerror = () => {
        uploadedImage = null;
        characterReady = false;
        setOutput('charOut', t.msg.photoError, false);
        renderCanvasPlaceholder();
      };
      reader.readAsDataURL(file);
    }

    function generateCharacter() {
      const t = I18N[currentLang];
      if (!uploadedImage) {
        setOutput('charOut', t.msg.photoFirst, false);
        return;
      }

      const traits = analyzeTraits(uploadedImage);
      const type = pickCharacterType(traits);
      renderCharacter(type, t.msg.charDone);
    }

    function rerollCharacter() {
      const t = I18N[currentLang];
      if (!uploadedImage) {
        setOutput('charOut', t.msg.photoFirst, false);
        return;
      }

      const traits = analyzeTraits(uploadedImage);
      const type = pickCharacterType(traits, lastType);
      renderCharacter(type, t.msg.rerolled);
    }

    function downloadCharacter() {
      if (!characterReady) {
        const t = I18N[currentLang];
        setOutput('charOut', t.msg.photoFirst, false);
        return;
      }
      const c = document.getElementById('charCanvas');
      const link = document.createElement('a');
      link.download = 'lookalike-character.png';
      link.href = c.toDataURL('image/png');
      link.click();
    }

    function summarizeText() {
      const t = I18N[currentLang];
      const input = document.getElementById('sumInput').value.trim();
      if (!input) {
        setOutput('sumOut', t.msg.enterText, false);
        return;
      }

      const sentences = input
        .replace(/\n+/g, ' ')
        .split(/(?<=[.!?])\s+|(?<=[다요])\s+/)
        .filter(Boolean);

      if (sentences.length <= 2) {
        setOutput('sumOut', input, false);
        return;
      }

      const keywords = t.summaryKeywords;
      const scored = sentences.map((s, i) => {
        let score = s.length * 0.01;
        keywords.forEach((k) => {
          if (s.toLowerCase().includes(k.toLowerCase())) score += 1.2;
        });
        if (i === 0 || i === sentences.length - 1) score += 0.4;
        return { s, i, score };
      });

      const pickCount = Math.max(2, Math.ceil(sentences.length * 0.35));
      const summary = scored
        .sort((a, b) => b.score - a.score)
        .slice(0, pickCount)
        .sort((a, b) => a.i - b.i)
        .map((v) => `- ${v.s.trim()}`)
        .join('\n');

      setOutput('sumOut', summary, false);
    }

    function convertUnit() {
      const t = I18N[currentLang];
      const value = Number(document.getElementById('convValue').value);
      const type = document.getElementById('convType').value;

      if (Number.isNaN(value)) {
        setOutput('convOut', t.msg.enterNumber, false);
        return;
      }

      let result = '';
      if (type === 'km-mile') result = `${value} km = ${(value * 0.621371).toFixed(4)} mile`;
      if (type === 'mile-km') result = `${value} mile = ${(value / 0.621371).toFixed(4)} km`;
      if (type === 'c-f') result = `${value} °C = ${(value * 9 / 5 + 32).toFixed(2)} °F`;
      if (type === 'f-c') result = `${value} °F = ${((value - 32) * 5 / 9).toFixed(2)} °C`;
      setOutput('convOut', result, false);
    }

    function generatePassword() {
      const len = Math.min(64, Math.max(8, Number(document.getElementById('pwLen').value) || 14));
      const mode = document.getElementById('pwMode').value;

      const pools = {
        letters: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
        alnum: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
        all: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}'
      };

      const chars = pools[mode];
      let pw = '';
      const rand = new Uint32Array(len);
      crypto.getRandomValues(rand);
      for (let i = 0; i < len; i++) {
        pw += chars[rand[i] % chars.length];
      }
      setOutput('pwOut', pw, false);
    }

    document.getElementById('charInput').addEventListener('change', onPhotoSelected);

    const savedTheme = localStorage.getItem('themeMode');
    const savedLang = localStorage.getItem('langMode');

    applyTheme(savedTheme === 'dark' ? 'dark' : 'light');
    applyLanguage(savedLang === 'en' ? 'en' : 'ko');
    renderCanvasPlaceholder();
  </script>
</body>
</html>
